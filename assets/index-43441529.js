import{_ as U}from"./mermaid-ec10c567.js";import{j as e,P as re,F as se,a as ie,c as p,M as ce,I as ue,b as me,d as he,u as de,e as ge,f as pe,A as fe,g as _e,h as v,i as ve,k as xe,l as ye,R as N,T as b,m as z,_ as Q,E as Ce}from"./profile-c8290faf.js";import{r as o,R as be}from"./react-a383d3d5.js";import"./react-dom-2b1e1bcb.js";import"./katex-f1cbb8ad.js";import"./react-router-dom-741688e6.js";const Se="_selectLanguage_17g4u_1",Le="_disable_17g4u_10",je="_languageItem_17g4u_16",ke="_active_17g4u_28",S={selectLanguage:Se,disable:Le,languageItem:je,active:ke},Te={js:"JavaScript",ts:"TypeScript",rs:"Rust",py:"Python",md:"Markdown",xml:"HTML",latex:"LaTex",cpp:"C++",sh:"Shell",zsh:"Shell"},Me=[{label:"JavaScript",value:"JavaScript"},{label:"TypeScript",value:"TypeScript"},{label:"JSX",value:"JSX"},{label:"TSX",value:"TSX"},{label:"HTML",value:"HTML"},{label:"CSS",value:"CSS"},{label:"Vue",value:"Vue"},{label:"C",value:"C"},{label:"C++",value:"C++"},{label:"C#",value:"C#"},{label:"Java",value:"Java"},{label:"Rust",value:"Rust"},{label:"Go",value:"Go"},{label:"Python",value:"Python"},{label:"Objective C",value:"Objective C"},{label:"Scale",value:"Scale"},{label:"JSON",value:"JSON"},{label:"XML",value:"HTML/XML"},{label:"YAML",value:"YAML"},{label:"HTTP",value:"HTTP"},{label:"Diff",value:"Diff"},{label:"Bash",value:"Bash"},{label:"Shell",value:"Shell"},{label:"MySQL",value:"MySQL"},{label:"SQL",value:"sql"},{label:"Latex",value:"stex"},{label:"Markdown",value:"markdown"}],K=h=>{const{value:s,onChange:L,className:i,style:x={},readonly:d}=h,[j,f]=o.useState(!1);return e.jsx(re,{placement:"bottom",open:!d&&j,onOpenChange:r=>{if(d){f(!1);return}f(r)},trigger:"click",styles:{body:{padding:4}},arrow:!1,content:e.jsx(se,{vertical:!0,gap:4,style:{height:400,overflow:"auto"},children:e.jsx(ie,{data:Me,renderItem:r=>e.jsx("div",{className:p(S.languageItem,{[S.active]:s===r.value}),onClick:()=>{d||(L(r.value),f(!1))},children:r.label},r.value)})}),children:e.jsx("div",{style:x,className:p(S.selectLanguage,i,{[S.disable]:d}),children:Te[s]||s})})},Ne="_codeBlockContainer_1uri9_1",Oe="_dark_1uri9_7",De="_readOnly_1uri9_12",we="_btnGroup_1uri9_15",Be="_copyButton_1uri9_30",Pe="_copyIcon_1uri9_41",He="_fullscreenButton_1uri9_45",Re="_windowsControl_1uri9_55",Ee="_languageSelect_1uri9_68",Ie="_CodeMirrorContainer_1uri9_74",Ae="_dragHandler_1uri9_98",Ve="_icon_1uri9_111",Ge="_canDrag_1uri9_114",Je="_dragging_1uri9_117",Fe="_drop_1uri9_120",Xe="_before_1uri9_123",qe="_after_1uri9_132",ze="_fullscreenOverlay_1uri9_141",Qe="_darkOverlay_1uri9_161",Ke="_fullscreenContent_1uri9_169",Ue="_fullscreenHeader_1uri9_185",We="_fullscreenLanguageSelect_1uri9_188",Ye="_fullscreenCodeMirror_1uri9_204",$e="_closeButton_1uri9_236",Ze="_loading_1uri9_247",a={codeBlockContainer:Ne,dark:Oe,readOnly:De,btnGroup:we,copyButton:Be,copyIcon:Pe,fullscreenButton:He,windowsControl:Re,languageSelect:Ee,CodeMirrorContainer:Ie,dragHandler:Ae,icon:Ve,canDrag:Ge,dragging:Je,drop:Fe,before:Xe,after:qe,fullscreenOverlay:ze,darkOverlay:Qe,fullscreenContent:Ke,fullscreenHeader:Ue,fullscreenLanguageSelect:We,fullscreenCodeMirror:Ye,closeButton:$e,loading:Ze},W=o.memo(({onCopy:h,onFullscreen:s})=>e.jsxs("div",{className:a.btnGroup,children:[e.jsx("div",{className:a.fullscreenButton,onClick:s,children:e.jsx(ce,{})}),e.jsx("div",{className:a.divider}),e.jsx("div",{className:a.copyButton,onClick:h,children:e.jsx(ue,{src:me,className:a.copyIcon})})]}));W.displayName="ToolbarButtons";const Y=o.memo(({canDrag:h,dragRef:s})=>e.jsx("div",{className:p(a.dragHandler,{[a.canDrag]:h}),contentEditable:!1,ref:s,children:e.jsx(he,{className:a.icon})}));Y.displayName="DragHandle";const et=[{name:"Auto",mode:"auto"},{name:"Apache",mode:"apache",mime:"text/apache",custom:!0,highlight:!0},{name:"Bash",mode:"shell",mime:"application/x-sh",highlight:!0},{name:"Plain Text",mode:"text"},{name:"C",mode:"clike",mime:"text/x-csrc",short:"c"},{name:"C++",mode:"clike",mime:"text/x-c++src",short:"c-like",highlight:!0},{name:"C#",mode:"clike",mime:"text/x-csharp",short:"csharp",highlight:!0},{name:"Clojure",mode:"clojure",highlight:!0},{name:"COBOL",mode:"cobol"},{name:"CoffeeScript",mode:"coffeescript",highlight:!0},{name:"Crystal",mode:"crystal",highlight:!0},{name:"CSS",mode:"css",highlight:!0},{name:"D",mode:"d",highlight:!0},{name:"Dart",mode:"dart",highlight:!0},{name:"Diff",mode:"diff",mime:"text/x-diff",highlight:!0},{name:"Django",mode:"django",highlight:!0},{name:"Docker",mode:"dockerfile",highlight:!0},{name:"Elixir",mode:"elixir",custom:!0,highlight:!0},{name:"Elm",mode:"elm",highlight:!0},{name:"Erlang",mode:"erlang",highlight:!0},{name:"F#",mime:"text/x-fsharp",mode:"mllike",short:"fsharp",highlight:!0},{name:"Fortran",mode:"fortran",highlight:!0},{name:"Gherkin",mode:"gherkin",highlight:!0},{name:"GraphQL",mode:"graphql",custom:!0},{name:"Go",mode:"go",mime:"text/x-go",highlight:!0},{name:"Groovy",mode:"groovy",highlight:!0},{name:"Handlebars",mode:"handlebars",highlight:!0},{name:"Haskell",mode:"haskell",highlight:!0},{name:"HTML/XML",mode:"htmlmixed"},{name:"HTML",mode:"htmlmixed"},{name:"HTTP",mime:"message/http",mode:"http"},{name:"Java",mode:"clike",mime:"text/x-java",short:"java",highlight:!0},{name:"JavaScript",mode:"javascript",short:"javascript",highlight:!0},{name:"JSON",mode:"javascript",mime:"application/json",short:"json",highlight:!0},{name:"JSX",mode:"jsx",short:"jsx"},{name:"Julia",mode:"julia",highlight:!0},{name:"Kotlin",mode:"clike",mime:"text/x-kotlin",short:"kotlin",highlight:!0},{name:"LaTeX",mode:"stex",short:"latex",highlight:!0},{name:"Lisp",mode:"commonlisp",short:"lisp",highlight:!0},{name:"Lua",mode:"lua",highlight:!0},{name:"Markdown",mode:"markdown",highlight:!0},{name:"Mathematica",mode:"mathematica",highlight:!0},{name:"MATLAB/Octave",mode:"octave",mime:"text/x-octave",short:"matlab",highlight:!0},{name:"MySQL",mode:"sql",mime:"text/x-mysql",short:"mysql"},{name:"N-Triples",mode:"ntriples",mime:"application/n-triples"},{name:"NGINX",mode:"nginx",highlight:!0},{name:"Nim",mode:"nim",custom:!0,highlight:!0},{name:"Nix",mode:"nix",highlight:!0},{name:"Objective C",mode:"clike",mime:"text/x-objectivec",short:"objectivec",highlight:!0},{name:"OCaml",mode:"mllike",short:"ocaml",highlight:!0},{name:"Pascal",mode:"pascal"},{name:"Perl",mode:"perl",highlight:!0},{name:"PHP",mode:"php",mime:"text/x-php",short:"php",highlight:!0},{name:"PowerShell",mode:"powershell",highlight:!0},{name:"Protocol Buffer",mode:"protobuf"},{name:"Python",mode:"python",highlight:!0},{name:"R",mode:"r",highlight:!0},{name:"RISC-V",mode:"riscv",custom:!0},{name:"Ruby",mode:"ruby",highlight:!0},{name:"Rust",mode:"rust",highlight:!0},{name:"Sass",mode:"sass"},{name:"Scala",mode:"clike",mime:"text/x-scala",short:"scala",highlight:!0},{name:"Smalltalk",mode:"smalltalk",highlight:!0},{name:"Solidity",mode:"solidity",custom:!0},{name:"SPARQL",mode:"sparql",mime:"application/sparql-query"},{name:"SQL",mode:"sql",highlight:!0},{name:"Stan",mode:"stan",highlight:!0},{name:"Stylus",mode:"stylus",mime:"stylus",highlight:!0},{name:"Swift",mode:"swift",highlight:!0},{name:"TCL",mode:"tcl",highlight:!0},{name:"TOML",mode:"toml"},{name:"Turtle",mode:"turtle",mime:"text/turtle"},{name:"TypeScript",mode:"javascript",mime:"application/typescript",short:"typescript",highlight:!0},{name:"TSX",mode:"jsx",mime:"text/typescript-jsx",short:"tsx"},{name:"Twig",mode:"twig",mime:"text/x-twig",highlight:!0},{name:"VB.NET",mode:"vb"},{name:"Verilog",mode:"verilog",highlight:!0},{name:"VHDL",mode:"vhdl",highlight:!0},{name:"Vue",mode:"vue"},{name:"XQuery",mode:"xquery",highlight:!0},{name:"YAML",mode:"yaml",highlight:!0}],tt=o.lazy(()=>U(()=>import("./CodeEditor-3f355997.js"),["assets/CodeEditor-3f355997.js","assets/profile-c8290faf.js","assets/react-a383d3d5.js","assets/react-dom-2b1e1bcb.js","assets/mermaid-ec10c567.js","assets/katex-f1cbb8ad.js","assets/react-router-dom-741688e6.js","assets/index-01d9da93.css"])),at=o.lazy(()=>U(()=>import("./FullscreenCodeEditor-877bca21.js"),["assets/FullscreenCodeEditor-877bca21.js","assets/profile-c8290faf.js","assets/react-a383d3d5.js","assets/react-dom-2b1e1bcb.js","assets/mermaid-ec10c567.js","assets/katex-f1cbb8ad.js","assets/react-router-dom-741688e6.js","assets/index-01d9da93.css"])),lt={js:"javascript",ts:"typescript",rs:"rust",py:"python",md:"markdown",xml:"html/xml",latex:"stex",cpp:"C++",sh:"shell",zsh:"shell"},nt=h=>{const{onChange:s,children:L,element:i,onDidMount:x,onWillUnmount:d,attributes:j}=h,{code:f,language:r,uuid:O}=i,[D,w]=o.useState(f),[B,$]=o.useState(),c=de(),_=ge(),{isDark:y}=pe(),k=o.useRef(null),[C,P]=o.useState(!1),u=o.useRef(null),m=o.useRef(null),{message:H}=fe.useApp(),{drag:Z,drop:ee,isDragging:te,canDrag:ae,canDrop:R,isBefore:E,isOverCurrent:I}=_e({element:i});o.useEffect(()=>{const t=lt[r]||r,n=et.find(l=>l.name.toLowerCase()===t.toLowerCase());n&&$(n)},[r]);const A=v((t,n,l)=>{const g=N.findPath(c,i);b.setNodes(c,{code:l},{at:g}),s&&s(l)}),le=v(async()=>{const t=z.get(O);if(navigator.clipboard&&t){const n=t.getValue();await navigator.clipboard.writeText(n),await H.success("复制代码成功")}else await H.error("复制代码失败")}),V=v(()=>{if(C){const t=m.current?.getValue()||"";if(w(t),u.current){u.current.setValue(t),u.current.refresh(),u.current.focus();const n=u.current.getDoc(),l=n.lineCount()-1,g=n.getLine(l).length;n.setCursor({line:l,ch:g})}}else{const t=u.current?.getValue()||"";w(t),setTimeout(()=>{if(m.current){m.current.setValue(t),m.current.refresh(),m.current.focus();const n=m.current.getDoc(),l=n.lineCount()-1,g=n.getLine(l).length;n.setCursor({line:l,ch:g})}},50)}P(!C)}),G=v(t=>{b.setNodes(c,{language:t},{at:N.findPath(c,i)})}),J=v((t,n)=>{if(Q(["delete","backspace"],n)&&t.getValue()===""){n.preventDefault();const l=N.findPath(c,i);Ce.withoutNormalizing(c,()=>{b.delete(c,{at:l}),b.insertNodes(c,{type:"paragraph",children:[{type:"formatted",text:""}]},{at:l,select:!0})}),z.delete(O)}if(Q("enter",n)&&!C){const l=t.getCursor(),g=t.getLine(l.line),X=t.lineCount();if(l.line===X-1&&g===""&&(n.preventDefault(),X!==1)){const T=t.getDoc(),M=l.line-1,q=T.getLine(M).length,ne={line:M,ch:q},oe={line:l.line,ch:l.ch};T.replaceRange("",ne,oe),T.setCursor({line:M,ch:q}),k.current&&k.current.addParagraph()}}}),F={inputStyle:"textarea",mode:B?.mime||B?.mode||"text/plain",theme:y?"blackboard":"one-light",scrollbarStyle:"null",viewportMargin:1/0,lineWrapping:!1,smartIndent:!0,extraKeys:{"Shift-Tab":"indentLess"},readOnly:_||R&&I,indentUnit:2,tabSize:2,cursorHeight:1,autoCloseBrackets:!0,tabindex:-1};return e.jsx("div",{contentEditable:!1,className:p(a.codeBlockContainer,{[a.dark]:y,[a.readOnly]:_,[a.dragging]:te,[a.drop]:I&&R,[a.before]:E,[a.after]:!E}),ref:ee,children:e.jsxs("div",{...j,children:[L,e.jsx(W,{onCopy:le,onFullscreen:V}),e.jsx(K,{readonly:_,className:a.languageSelect,value:r,onChange:G}),e.jsx(o.Suspense,{fallback:e.jsx("div",{className:a.loading,children:"加载代码编辑器中..."}),children:e.jsx(tt,{value:D||"",options:F,className:a.CodeMirrorContainer,onChange:A,onKeyDown:J,editorDidMount:t=>{u.current=t,x&&x(t)},editorWillUnmount:t=>{d&&d(t),u.current=null}})}),e.jsx(ve,{element:i,ref:k}),e.jsx(Y,{canDrag:ae,dragRef:Z}),C&&e.jsx(xe,{children:e.jsx("div",{className:p(a.fullscreenOverlay,{[a.darkOverlay]:y}),onClick:()=>P(!1),children:e.jsxs("div",{className:p(a.fullscreenContent,{[a.dark]:y}),onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:a.fullscreenHeader,children:[e.jsx(K,{readonly:_,className:a.fullscreenLanguageSelect,value:r,onChange:G}),e.jsx("div",{className:a.closeButton,onClick:V,children:e.jsx(ye,{size:20})})]}),e.jsx(o.Suspense,{fallback:e.jsx("div",{className:a.loading,children:"加载全屏编辑器中..."}),children:e.jsx(at,{value:D||"",options:F,className:a.fullscreenCodeMirror,onChange:A,onKeyDown:J,editorDidMount:t=>{m.current=t,_||setTimeout(()=>{t.refresh(),t.focus()},50)},editorWillUnmount:()=>{m.current=null}})})]})})})]})})},mt=be.memo(nt);export{mt as default};
