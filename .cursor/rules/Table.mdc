---
alwaysApply: false
---

# Table ç»„ä»¶æŠ€æœ¯æ–‡æ¡£

## æ¦‚è¿°

Table ç»„ä»¶æ˜¯ä¸€ä¸ªåŸºäº React çš„é«˜æ€§èƒ½ã€æ’ä»¶åŒ–è¡¨æ ¼ç»„ä»¶ï¼Œæ”¯æŒä¸°å¯Œçš„å•å…ƒæ ¼ç±»å‹ã€æ‹–æ‹½æ’åºã€é”®ç›˜å¯¼èˆªã€ä¸»é¢˜åˆ‡æ¢ç­‰åŠŸèƒ½ã€‚è¯¥ç»„ä»¶é‡‡ç”¨æ’ä»¶æ¶æ„è®¾è®¡ï¼Œå…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## ç›®å½•ç»“æ„

```
Table/
â”œâ”€â”€ components/                    # æ ¸å¿ƒç»„ä»¶
â”‚   â”œâ”€â”€ Cell.tsx                  # å•å…ƒæ ¼ç»„ä»¶
â”‚   â”œâ”€â”€ ColumnEditModal.tsx       # åˆ—ç¼–è¾‘æ¨¡æ€æ¡†
â”‚   â”œâ”€â”€ ColumnHeader.tsx          # åˆ—å¤´ç»„ä»¶
â”‚   â”œâ”€â”€ Row.tsx                   # è¡Œç»„ä»¶
â”‚   â”œâ”€â”€ SelectEditor.tsx          # é€‰æ‹©ç¼–è¾‘å™¨
â”‚   â”œâ”€â”€ SelectList.tsx            # é€‰æ‹©åˆ—è¡¨ç»„ä»¶
â”‚   â”œâ”€â”€ Table.tsx                 # ä¸»è¡¨æ ¼ç»„ä»¶
â”‚   â”œâ”€â”€ TableContent.tsx          # è¡¨æ ¼å†…å®¹ç»„ä»¶
â”‚   â””â”€â”€ VerticalSelectList.tsx    # å‚ç›´é€‰æ‹©åˆ—è¡¨
â”œâ”€â”€ plugins/                      # æ’ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ AttachmentPlugin/         # é™„ä»¶æ’ä»¶
â”‚   â”œâ”€â”€ CheckboxPlugin/           # å¤é€‰æ¡†æ’ä»¶
â”‚   â”œâ”€â”€ DatePlugin/               # æ—¥æœŸæ’ä»¶
â”‚   â”œâ”€â”€ ImagePlugin/              # å›¾ç‰‡æ’ä»¶
â”‚   â”œâ”€â”€ LinkPlugin/               # é“¾æ¥æ’ä»¶
â”‚   â”œâ”€â”€ MultiSelectPlugin/        # å¤šé€‰æ’ä»¶
â”‚   â”œâ”€â”€ NumberPlugin/             # æ•°å­—æ’ä»¶
â”‚   â”œâ”€â”€ ProgressPlugin/           # è¿›åº¦æ’ä»¶
â”‚   â”œâ”€â”€ RichTextPlugin/           # å¯Œæ–‡æœ¬æ’ä»¶
â”‚   â”œâ”€â”€ SelectPlugin/             # å•é€‰æ’ä»¶
â”‚   â”œâ”€â”€ StarPlugin/               # è¯„åˆ†æ’ä»¶
â”‚   â”œâ”€â”€ TextPlugin/               # æ–‡æœ¬æ’ä»¶
â”‚   â””â”€â”€ index.ts                  # æ’ä»¶ç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ hooks/                        # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ useCellEditor.ts          # å•å…ƒæ ¼ç¼–è¾‘å™¨ Hook
â”‚   â”œâ”€â”€ useColumnResize.ts        # åˆ—å®½è°ƒæ•´ Hook
â”‚   â”œâ”€â”€ useColumnVisibility.ts    # åˆ—æ˜¾ç¤ºéšè— Hook
â”‚   â”œâ”€â”€ useKeyboardNavigation.ts  # é”®ç›˜å¯¼èˆª Hook
â”‚   â”œâ”€â”€ useTableStore.ts          # è¡¨æ ¼çŠ¶æ€ Hook
â”‚   â”œâ”€â”€ useValidation.ts          # æ•°æ®éªŒè¯ Hook
â”‚   â””â”€â”€ index.ts                  # Hooks ç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ constants/                    # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ select.ts                 # é€‰æ‹©ç›¸å…³å¸¸é‡
â”‚   â””â”€â”€ index.ts                  # å¸¸é‡ç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ PluginManager.ts              # æ’ä»¶ç®¡ç†å™¨
â”œâ”€â”€ TableContext.tsx              # React Context
â”œâ”€â”€ TableStore.ts                 # Zustand çŠ¶æ€ç®¡ç†
â”œâ”€â”€ types.ts                      # TypeScript ç±»å‹å®šä¹‰
â””â”€â”€ index.ts                      # ç»„ä»¶ç»Ÿä¸€å¯¼å‡º
```

## æ¶æ„è®¾è®¡

### 1. æ’ä»¶æ¶æ„

Table ç»„ä»¶é‡‡ç”¨æ’ä»¶æ¶æ„ï¼Œæ¯ä¸ªå•å…ƒæ ¼ç±»å‹éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ’ä»¶ï¼Œé€šè¿‡ `PluginManager` è¿›è¡Œç®¡ç†ã€‚

#### æ’ä»¶æ¥å£

```typescript
interface CellPlugin<T> {
  type: string; // æ’ä»¶ç±»å‹æ ‡è¯†
  name: string; // æ’ä»¶æ˜¾ç¤ºåç§°
  Icon?: React.ComponentType; // åˆ—å¤´å›¾æ ‡ç»„ä»¶
  Renderer: React.ComponentType; // å•å…ƒæ ¼æ¸²æŸ“ç»„ä»¶
  Editor?: React.ComponentType; // å•å…ƒæ ¼ç¼–è¾‘ç»„ä»¶
  editable?: boolean; // æ˜¯å¦å¯ç¼–è¾‘
  onMount?: () => void; // æ’ä»¶æŒ‚è½½é’©å­
  onUnmount?: () => void; // æ’ä»¶å¸è½½é’©å­
  beforeSave?: (value, config) => any; // ä¿å­˜å‰æ•°æ®è½¬æ¢
  afterLoad?: (value, config) => any; // åŠ è½½åæ•°æ®è½¬æ¢
  onColumnCleanup?: (columnData) => Promise<void>; // åˆ—åˆ é™¤æ—¶æ¸…ç†
}
```

#### æ’ä»¶ç®¡ç†å™¨

```typescript
class PluginManager {
  registerPlugin(plugin: CellPlugin): void; // æ³¨å†Œå•ä¸ªæ’ä»¶
  registerPlugins(plugins: CellPlugin[]): void; // æ‰¹é‡æ³¨å†Œæ’ä»¶
  getPlugin(type: string): CellPlugin; // è·å–æ’ä»¶
  loadAllPlugins(): void; // åŠ è½½æ‰€æœ‰æ’ä»¶
  transformBeforeSave(type, value, config): any; // ä¿å­˜å‰è½¬æ¢
  transformAfterLoad(type, value, config): any; // åŠ è½½åè½¬æ¢
  executeColumnCleanup(type, columnData): void; // æ‰§è¡Œåˆ—æ¸…ç†
}
```

### 2. çŠ¶æ€ç®¡ç†

ä½¿ç”¨ Zustand è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œæ”¯æŒå†å²è®°å½•å’Œæ’¤é”€é‡åšåŠŸèƒ½ã€‚

#### ä¸»è¦çŠ¶æ€

```typescript
interface TableState {
  // æ•°æ®çŠ¶æ€
  columns: ColumnDef[]; // åˆ—å®šä¹‰
  rows: RowData[]; // è¡Œæ•°æ®
  columnOrder: string[]; // åˆ—é¡ºåº
  columnWidths: Record<string, number>; // åˆ—å®½åº¦

  // äº¤äº’çŠ¶æ€
  selectedCell: CellCoord | null; // é€‰ä¸­å•å…ƒæ ¼
  editingCell: CellCoord | null; // ç¼–è¾‘ä¸­å•å…ƒæ ¼

  // å†å²è®°å½•
  history: TableSnapshot[]; // å†å²å¿«ç…§
  historyIndex: number; // å†å²ç´¢å¼•

  // æ“ä½œæ–¹æ³•
  updateCellValue: (rowId, columnId, value) => void;
  moveColumn: (fromIndex, toIndex) => void;
  moveRow: (fromIndex, toIndex) => void;
  addRow: (row?) => void;
  deleteRow: (rowId) => void;
  addColumn: (column) => void;
  deleteColumn: (columnId) => void;
  // ... æ›´å¤šæ–¹æ³•
}
```

### 3. æ ¸å¿ƒç»„ä»¶

#### Table (ä¸»ç»„ä»¶)

- åˆå§‹åŒ–æ’ä»¶ç®¡ç†å™¨
- åˆ›å»ºçŠ¶æ€å­˜å‚¨
- æä¾› Context
- å¤„ç†ä¸»é¢˜å’Œé”®ç›˜å¯¼èˆª

#### TableContent (è¡¨æ ¼å†…å®¹)

- æ¸²æŸ“è¡¨æ ¼ç»“æ„
- å¤„ç†è™šæ‹ŸåŒ–æ»šåŠ¨
- ç®¡ç†åˆ—å¤´å’Œè¡Œ
- å¤„ç†æ‹–æ‹½æ’åº

#### Cell (å•å…ƒæ ¼)

- æ¸²æŸ“å•å…ƒæ ¼å†…å®¹
- å¤„ç†ç¼–è¾‘æ¨¡å¼åˆ‡æ¢
- ç®¡ç†é€‰ä¸­çŠ¶æ€
- é›†æˆæ’ä»¶æ¸²æŸ“å™¨

#### Row (è¡Œç»„ä»¶)

- æ¸²æŸ“è¡Œå†…å®¹
- æ”¯æŒè¡Œæ‹–æ‹½
- å¤„ç†è¡Œæ“ä½œ

#### ColumnHeader (åˆ—å¤´)

- æ¸²æŸ“åˆ—å¤´
- æ”¯æŒåˆ—æ‹–æ‹½
- å¤„ç†åˆ—å®½è°ƒæ•´
- æ˜¾ç¤ºæ’ä»¶å›¾æ ‡

## æ ¸å¿ƒåŠŸèƒ½

### 1. è™šæ‹ŸåŒ–æ¸²æŸ“

ä½¿ç”¨ `@tanstack/react-virtual` å®ç°è¡Œè™šæ‹ŸåŒ–ï¼Œæ”¯æŒå¤§é‡æ•°æ®æ¸²æŸ“ã€‚

### 2. æ‹–æ‹½æ’åº

åŸºäº `react-dnd` å®ç°ï¼š

- åˆ—æ‹–æ‹½æ’åº
- è¡Œæ‹–æ‹½æ’åº
- æ‹–æ‹½é¢„è§ˆæ•ˆæœ

### 3. é”®ç›˜å¯¼èˆª

æ”¯æŒæ–¹å‘é”®å¯¼èˆªå’Œå¿«æ·é”®æ“ä½œï¼š

- æ–¹å‘é”®ç§»åŠ¨é€‰æ‹©
- Enter/Space è¿›å…¥ç¼–è¾‘
- Escape é€€å‡ºç¼–è¾‘

### 4. ä¸»é¢˜æ”¯æŒ

æ”¯æŒ light/dark ä¸»é¢˜åˆ‡æ¢ï¼Œæ‰€æœ‰ç»„ä»¶å’Œæ’ä»¶éƒ½æ”¯æŒä¸»é¢˜ã€‚

### 5. å†å²è®°å½•

æ”¯æŒæ’¤é”€é‡åšåŠŸèƒ½ï¼Œè‡ªåŠ¨ä¿å­˜å†å²å¿«ç…§ã€‚

## ä»£ç è§„èŒƒ

### 1. ç»„ä»¶è§„èŒƒ

#### ä½¿ç”¨ memo ä¼˜åŒ–æ€§èƒ½

```typescript
const Component = memo(({ props }) => {
  // ç»„ä»¶é€»è¾‘
});
```

#### ä½¿ç”¨ useMemoizedFn å¤„ç†å‡½æ•°

```typescript
const handleClick = useMemoizedFn(() => {
  // å¤„ç†é€»è¾‘
});
```

#### ä½¿ç”¨ classNames å¤„ç†æ ·å¼

```typescript
const className = classNames("base-class", {
  "conditional-class": condition,
  "theme-dark": isDark,
});
```

### 2. TypeScript è§„èŒƒ

#### ä¸¥æ ¼ç±»å‹å®šä¹‰

- ä¸ä½¿ç”¨ `any` ç±»å‹
- å®šä¹‰å®Œæ•´çš„æ¥å£
- ä½¿ç”¨æ³›å‹çº¦æŸ

#### ç±»å‹å¯¼å‡º

```typescript
export type { TableProps, ColumnDef, CellValue, CellPlugin };
```

### 3. æ–‡ä»¶ç»„ç»‡è§„èŒƒ

#### ç»„ä»¶æ–‡ä»¶ç»“æ„

```
PluginName/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Renderer.tsx      # æ¸²æŸ“ç»„ä»¶
â”‚   â”œâ”€â”€ Editor.tsx        # ç¼–è¾‘ç»„ä»¶
â”‚   â””â”€â”€ index.ts          # ç»„ä»¶å¯¼å‡º
â”œâ”€â”€ types.ts              # ç±»å‹å®šä¹‰
â””â”€â”€ index.tsx             # æ’ä»¶ä¸»æ–‡ä»¶
```

#### å¯¼å‡ºè§„èŒƒ

```typescript
// æ’ä»¶å†…éƒ¨ç»„ä»¶å¯¼å‡º
export { default as Renderer } from "./Renderer";
export { default as Editor } from "./Editor";

// ä¸»æ–‡ä»¶å¯¼å‡º
export default PluginName;
```

## æ’ä»¶ç¼–å†™è§„èŒƒ

### 1. åŸºç¡€æ’ä»¶æ¨¡æ¿

```typescript
import { CellPlugin } from "../../types";
import Renderer from "./components/Renderer";
import Editor from "./components/Editor";
import { PluginIcon } from "react-icons/md";

const PluginName: CellPlugin<ConfigType> = {
  type: "plugin-type",
  name: "æ’ä»¶åç§°",
  editable: true,
  Renderer,
  Editor,
  Icon: ({ className }) => <PluginIcon className={className} />,

  beforeSave: (value, config) => {
    // ä¿å­˜å‰æ•°æ®å¤„ç†
    return processedValue;
  },

  afterLoad: (value, config) => {
    // åŠ è½½åæ•°æ®å¤„ç†
    return processedValue;
  },

  onColumnCleanup: async (columnData) => {
    // åˆ—åˆ é™¤æ—¶æ¸…ç†èµ„æº
    await cleanupResources(columnData);
  },
};

export default PluginName;
```

### 2. æ¸²æŸ“å™¨è§„èŒƒ

```typescript
interface RendererProps {
  value: CellValue;
  column: ColumnDef;
  theme: "light" | "dark";
  readonly: boolean;
  onCellValueChange: (newValue: CellValue) => void;
}

const Renderer: React.FC<RendererProps> = memo(({
  value,
  column,
  theme,
  readonly,
  onCellValueChange,
}) => {
  const isDark = theme === "dark";

  // æ¸²æŸ“é€»è¾‘
  return (
    <div className="w-full h-full flex items-center px-2">
      {/* å†…å®¹ */}
    </div>
  );
});
```

### 3. ç¼–è¾‘å™¨è§„èŒƒ

```typescript
interface EditorProps {
  value: CellValue;
  column: ColumnDef;
  onCellValueChange: (newValue: CellValue) => void;
  onFinishEdit: () => void;
  onColumnChange: (column: ColumnDef) => void;
  theme: "light" | "dark";
  readonly: boolean;
}

const Editor: React.FC<EditorProps> = memo(({
  value,
  onCellValueChange,
  onFinishEdit,
  theme,
  readonly,
}) => {
  // ç¼–è¾‘é€»è¾‘

  return (
    <div className="w-full h-full">
      {/* ç¼–è¾‘ç»„ä»¶ */}
    </div>
  );
});
```

### 4. æ’ä»¶å¼€å‘è¦ç‚¹

#### ä¸»é¢˜æ”¯æŒ

- æ‰€æœ‰æ’ä»¶å¿…é¡»æ”¯æŒ light/dark ä¸»é¢˜
- ä½¿ç”¨æ¡ä»¶æ ·å¼å¤„ç†ä¸»é¢˜å·®å¼‚

#### æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ memo åŒ…è£…ç»„ä»¶
- ä½¿ç”¨ useMemoizedFn å¤„ç†äº‹ä»¶
- é¿å…ä¸å¿…è¦çš„æ¸²æŸ“

#### æ•°æ®å¤„ç†

- å®ç° beforeSave å’Œ afterLoad è¿›è¡Œæ•°æ®è½¬æ¢
- å¤„ç†è¾¹ç•Œæƒ…å†µå’Œé”™è¯¯æ•°æ®
- å®ç°æ•°æ®éªŒè¯

#### èµ„æºæ¸…ç†

- å®ç° onColumnCleanup æ¸…ç†èµ„æº
- å¤„ç†å¼‚æ­¥æ¸…ç†æ“ä½œ
- ç¡®ä¿æ— å†…å­˜æ³„æ¼

### 5. å†…ç½®æ’ä»¶å‚è€ƒ

#### ç®€å•æ’ä»¶ç¤ºä¾‹ (TextPlugin)

```typescript
const TextPlugin: CellPlugin<any> = {
  type: "text",
  name: "æ–‡æœ¬",
  editable: true,
  Renderer,
  Editor,
  Icon: ({ className }) => <MdTextFields className={className} />,
  beforeSave: (value) => value,
  afterLoad: (value) => value,
};
```

#### å¤æ‚æ’ä»¶ç¤ºä¾‹ (RichTextPlugin)

```typescript
const RichTextPlugin: CellPlugin<RichTextPluginConfig> = {
  type: "rich-text",
  name: "å¯Œæ–‡æœ¬",
  editable: false,  // é€šè¿‡æ¸²æŸ“å™¨ç›´æ¥æ“ä½œ
  Renderer,
  Icon: ({ className }) => <MdDescription className={className} />,

  beforeSave: (value) => {
    return Array.isArray(value)
      ? value.filter(item => item && item.contentId)
      : [];
  },

  afterLoad: (value) => {
    return Array.isArray(value)
      ? value.filter(item => item && item.contentId)
      : [];
  },

  onColumnCleanup: async (columnData) => {
    // æ¸…ç†å…³è”çš„å†…å®¹è®°å½•
    const contentIds = extractContentIds(columnData);
    await Promise.allSettled(
      contentIds.map(id => deleteContent(id))
    );
  },
};
```

## ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºç¡€ä½¿ç”¨

```tsx
import Table from "@/components/Table";

const MyTable = () => {
  const columns = [
    { id: "name", title: "å§“å", type: "text", width: 200 },
    { id: "age", title: "å¹´é¾„", type: "number", width: 100 },
    { id: "email", title: "é‚®ç®±", type: "text", width: 250 },
  ];

  const data = [
    { id: "1", name: "å¼ ä¸‰", age: 25, email: "zhang@example.com" },
    { id: "2", name: "æå››", age: 30, email: "li@example.com" },
  ];

  const columnOrder = ["name", "age", "email"];

  return (
    <Table
      columns={columns}
      data={data}
      columnOrder={columnOrder}
      onChange={(tableData) => console.log(tableData)}
      theme="light"
      readonly={false}
    />
  );
};
```

### 2. è‡ªå®šä¹‰æ’ä»¶

```tsx
import Table, { CellPlugin } from "@/components/Table";

// è‡ªå®šä¹‰æ’ä»¶
const CustomPlugin: CellPlugin<any> = {
  type: "custom",
  name: "è‡ªå®šä¹‰",
  editable: true,
  Renderer: ({ value }) => <div>{value}</div>,
  Editor: ({ value, onCellValueChange, onFinishEdit }) => (
    <input
      value={value}
      onChange={(e) => onCellValueChange(e.target.value)}
      onBlur={onFinishEdit}
    />
  ),
  Icon: () => <span>ğŸ¨</span>,
};

const MyTable = () => {
  return (
    <Table
      columns={columns}
      data={data}
      columnOrder={columnOrder}
      plugins={[CustomPlugin]} // æ³¨å†Œè‡ªå®šä¹‰æ’ä»¶
    />
  );
};
```

## æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤§é‡æ•°æ®æ—¶æ³¨æ„è™šæ‹ŸåŒ–é…ç½®å’Œç»„ä»¶ä¼˜åŒ–
2. **å†…å­˜ç®¡ç†**ï¼šæ’ä»¶å¼€å‘æ—¶æ³¨æ„èµ„æºæ¸…ç†ï¼Œé¿å…å†…å­˜æ³„æ¼
3. **ç±»å‹å®‰å…¨**ï¼šä¸¥æ ¼ä½¿ç”¨ TypeScriptï¼Œé¿å… any ç±»å‹
4. **ä¸»é¢˜å…¼å®¹**ï¼šç¡®ä¿æ‰€æœ‰è‡ªå®šä¹‰æ’ä»¶æ”¯æŒä¸»é¢˜åˆ‡æ¢
5. **æ•°æ®ä¸€è‡´æ€§**ï¼šç¡®ä¿ beforeSave å’Œ afterLoad çš„æ•°æ®è½¬æ¢ä¸€è‡´æ€§

## æ‰©å±•å¼€å‘

### 1. æ–°å¢æ’ä»¶ç±»å‹

- åˆ›å»ºæ’ä»¶ç›®å½•å’Œæ–‡ä»¶
- å®ç° Renderer å’Œ Editor ç»„ä»¶
- å®šä¹‰ç±»å‹å’Œé…ç½®
- æ³¨å†Œåˆ°æ’ä»¶ç³»ç»Ÿ

### 2. æ‰©å±•è¡¨æ ¼åŠŸèƒ½

- ä¿®æ”¹ TableStore æ·»åŠ æ–°çŠ¶æ€
- æ›´æ–°ç»„ä»¶é€»è¾‘
- æ·»åŠ ç›¸åº”çš„ Hook

### 3. ä¸»é¢˜å®šåˆ¶

- ä¿®æ”¹ CSS å˜é‡
- æ›´æ–°ä¸»é¢˜é…ç½®
- ç¡®ä¿æ‰€æœ‰ç»„ä»¶æ”¯æŒ

---

**æ³¨æ„ï¼šè‹¥æœ‰ç›¸å…³æ›´æ–°ï¼Œè¯·æ›´æ–°æ­¤æ–‡æ¡£**
